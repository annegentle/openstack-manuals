<?xml version="1.0" encoding="UTF-8"?>
<section xml:id="install-config-glance"
    xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
    <title>Installing and Configuring the Image Service</title>
    <para>First, you need to add a signing key for the
        Cloud Builders repository that contains packages
        that are known and tested to work together, such
        as diablo-d5 or diablo-final. Once you add the
        signing key, you add a repository entry pointing
        to it and update your repo pointer with an apt-get
        command. </para>
    <literallayout class="monospaced">sudo apt-key adv --keyserver hkp://subkeys.pgp.net --recv F87CBDE0</literallayout>
    <literallayout class="monospaced">sudo echo "deb http://ops.rcb.me/packages maverick diablo-final" > /etc/apt/sources.list.d/rcb-sources.list</literallayout>
    
    <para>Install the Image service:</para>
    <literallayout class="monospaced">sudo apt-get install glance</literallayout>
    <para>Configure the backend data store. For MySQL, create a
        glance MySQL database and a glance MySQL user. Grant the
        "glance" user full access to the glance MySQL
        database.</para>
    <para>Start the mysql command line client by running:</para>
    <para><literallayout class="monospaced">mysql -u root -p</literallayout></para>
    <para>Enter the mysql root user's password when prompted.</para>
    <para>To configure the MySQL database, create the glance database. </para>
    <para><literallayout class="monospaced">mysql> CREATE DATABASE glance;</literallayout></para>
    <para>Create a MySQL user for the newly-created glance database that
        has full control of the database. </para>
    <para><literallayout class="monospaced">mysql> GRANT ALL ON glance.* TO 'glance'@'%' IDENTIFIED BY 'yourpassword';</literallayout></para>
    <para>Enter quit at the mysql> prompt to exit MySQL.</para>
    <para><literallayout class="monospaced">mysql> quit</literallayout></para>
    <para>Edit /etc/glance/glance-registry.conf to include the
        sql_connection to use the backend data store you just created,
        such as
        mysql://glance:yourpassword@192.168.206.129/glance.</para>
    <para>Create the tables in your backend data
        store:</para>
    <literallayout class="monospaced">sudo glance-manage db_sync</literallayout>
    <para>Now you can load your initial image and spin up your first
        VM if you want to use the EC2 API and euca- or nova-client
        commands. For Dashboard integration, you need to install the
        OpenStack Identity service, Keystone. </para>
</section>
